<IfModule mod_proxy.c>

  ProxyRequests off
  ProxyTimeout 5
  
  <Proxy *>
    Order deny,allow
    Allow from all
  </Proxy>

  ProxyPass /balancer-manager !
  <Location /balancer-manager>
    SetHandler balancer-manager
#    Order deny,allow
#    Deny from all
#    Allow from XXX.XXX.XXX.XXX
  </Location>

  ProxyHCExpr ok23 {%{REQUEST_STATUS} =~ /^[23]/}

  ProxyPass / balancer://mycluster/ lbmethod=byrequests timeout=5
#  ProxyMatch 正規表現でプロキシしたい場合
  ProxyPassReverse / balancer://mycluster/
  <Proxy balancer://mycluster>
    BalancerMember http://k8s-testapp-svc:3000 loadfactor=1 failontimeout=On retry=3 hcmethod=GET hcuri=/api/health/readiness hcexpr=ok23
    BalancerMember http://sorry:8080 status=+H
#    ProxySet stickysession=ROUTEID
  </Proxy>

</IfModule>
